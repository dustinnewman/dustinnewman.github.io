<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Dustin Newman's blog"><link rel="shortcut icon" type=image/x-icon href=https://dustinnewman.net/favicon.ico><link rel=stylesheet href=/css/style.min.css><title>HFS+ to ext4</title></head><body><header><h2><a href=https://dustinnewman.net>Dustin Newman</a></h2><nav><ul><li><a href=/ title=posts>posts</a></li><li><a href=/about/ title=about>about</a></li></ul></nav></header><main><article><header><h1>HFS+ to ext4</h1><div><time>November 13, 2023</time></div></header><p>This is a straight-forward guide to copy a MacOS HFS+ filesystem partition to a Linux ext4 partition. When I looked online, I saw constant warnings and cautionary tales about how this is an inherently dangerous operation and you should never perform it. As I had a 5 TB hard drive sitting right in front me with only 1.2 TB used, the thought of purchasing a new hard drive because some risk is involved was ludicrous. After all, we are technologists. Transferring files from one file system to another should not raise so much handwringing.</p><p>That said, here is your one and only warning if you decide to follow this guide. Any time you work with important data (and I assume any data you follow this guide for is important), you should have a backup. Even in <code>$CURRENT_YEAR</code>, there is always a risk with data corruption or some hardware failure which prevents successful data transfer. If you do not make a backup, you have to be okay with total data loss. If you have any further objections than this, I assume you then know enough to do it a better and safer way. Note that you must have at least as much free space on your drive as you do used space e.g. if you are using 1 TB of data, you must have 1 TB free as well. With that out of the way, let&rsquo;s get started.</p><h2 id=on-your-mac>On your Mac</h2><p>First, plug in the hard drive to your Mac. You should see your disk show up in the output of the <code>diskutil list</code> command.</p><pre><code class=language-sh>diskutil list

/dev/disk0 (internal, physical):
   #:                       TYPE NAME                    SIZE       IDENTIFIER
...
/dev/disk6 (external, physical):
   #:                       TYPE NAME                    SIZE       IDENTIFIER
   0:      GUID_partition_scheme                        *5.0 TB     disk6
   1:                        EFI EFI                     209.7 MB   disk6s1
   2:                  Apple_HFS SEAGATE                 5.0 TB     disk6s2
</code></pre><p>In my case, I know I have a 5 TB hard drive, so it is listed as <code>disk6</code>. We want to specifically deal with the <code>disk6s2</code> partition. However, your disk will of course be different from mine. To avoid confusion, set the following shell variable, replacing the value with your disk identifier:</p><pre><code class=language-sh>export DISK_ID=&lt;YOUR DISK PARTITION&gt;
# e.g. export DISK_ID=disk6s2
</code></pre><p>In my case, the entire 5 TB was allocated for the HFS+ file system. This is not going to work because I need two equal portions to transfer over the files: the existing one for HFS, and another one greater than or equal in size for ext4. So we have to resize the existing partition. If you have more than half your hard drive already used, <strong>do not do this</strong>. <strong>You will lose your data.</strong></p><p>For disk utility to allow us to resize, we have to make sure journaling is enabled.</p><pre><code class=language-sh>diskutil enableJournal $DISK_ID
</code></pre><p>And now we can resize. In my case, I only had 1.2 TB occupied, so I will resize to 2 TB, making sure that we have enough space for the ext4 partition while not resulting in data loss of the existing HFS+ data.</p><pre><code class=language-sh>diskutil resizeVolume disk6s2 2T

/dev/disk6 (external, physical):
   #:                       TYPE NAME                    SIZE       IDENTIFIER
   0:      GUID_partition_scheme                        *5.0 TB     disk6
   1:                        EFI EFI                     209.7 MB   disk6s1
   2:                  Apple_HFS SEAGATE                 2.0 TB     disk6s2
                    (free space)                         3.0 TB     -
</code></pre><p>Now we need to disable journaling.</p><pre><code class=language-sh>diskutil disableJournal disk6s2
</code></pre><p>And we can safely eject the drive. Note that we eject the entire disk, not the partition. Please replace the following with your actual disk.</p><pre><code class=language-sh>diskutil eject &lt;YOUR DISK&gt;
# e.g. diskutil eject disk6
</code></pre><p>It is now time to unplug the disk from your Mac and plug it into your Linux device.</p><h2 id=on-linux>On Linux</h2><p>As always, make sure your system is up to date.</p><pre><code class=language-sh>sudo apt-get update
</code></pre><p>We need the <code>hfsprogs</code> program to work with the HFS file system on Linux systems. As its <a href=https://packages.ubuntu.com/jammy/hfsprogs>package page</a> states, <code>hfsprogs</code> is &ldquo;mkfs and fsck for HFS and HFS+ file systems&rdquo;.</p><pre><code class=language-sh>sudo apt-get install hfsprogs
</code></pre><p>You now need to get the disk information for your drive.</p><pre><code class=language-sh>sudo fdisk -l
Device      Start        End    Sectors  Size Type
/dev/sda1      34     409633     409600  200M EFI System
/dev/sda2  411648 9767541133 9767129486  2T   HFS / HFS+
</code></pre><p>For this portion, I even more highly recommend using shell variables to avoid mistakes since we are actively working with two different filesystems here, whereas before we only had one.</p><pre><code class=language-sh>export HFS_DISK_ID=/dev/sda2
</code></pre><p>We check the integrity of the HFS+ filesystem with the <code>fsck</code> from <code>hfsprogs</code> (<code>fsck.hfsplus</code>) and then unmount it, since it is never a good idea to operate on a mounted filesystem.</p><pre><code class=language-sh>sudo fsck.hfsplus $HFS_DISK_ID
sudo umount $HFS_DISK_ID
</code></pre><p>Now time to finally create the new ext4 partition! We do this with the <code>fdisk</code> command. <code>fdisk</code> is used to manage disk partitions on Linux systems. It will open up a set of prompts requiring your input. I will list what to enter for each prompt.</p><pre><code class=language-sh>sudo fdisk /dev/sda
</code></pre><ul><li>Command should be <code>n</code> for new partition</li><li>Partition number should be next after HFS partition, in my case, 3</li><li>Start can be default to start right after existing HFS partition</li><li>Size depends on your specifics. For me, it should be <code>+2T</code> for 2 TB</li><li><code>w</code> to write the command to disk</li></ul><p>Woohoo! Our partition is created. Store it in an environment variable.</p><pre><code class=language-sh>export EXT_DISK_ID=sda3
</code></pre><p>And now we need to actually make this partition use the ext4 filesystem.</p><pre><code class=language-sh>sudo mkfs.ext4 $EXT_DISK_ID
</code></pre><p>In order to do anything with these filesystems, we need to mount them. The mount directory paths can be anything you want, but for simplicity I&rsquo;d recommend just following these unless you have a good reason. These are where the environment variables really come in handy to avoid mixups.</p><pre><code class=language-sh>sudo mkdir /mnt/hfsplus
sudo mkdir /mnt/ext4
sudo mount -t hfsplus -o force,rw $HFS_DISK_ID /mnt/hfsplus
sudo mount $EXT_DISK_ID /mnt/ext4
</code></pre><p>Now the actual transfer. For this, I used <code>rsync</code>. Note that for my 1.2 TB, this transfer took 20 hours. The extended length of this transfer also increases the likelihood of hardware failure, network failure (which happened to me twice during this process, thanks Xfinity), or power supply issues. Please take care to stabilize your system as much as possible.</p><pre><code class=language-sh>sudo rsync -av /mnt/hfsplus/ /mnt/ext4/
</code></pre></article></main><footer></footer></body></html>